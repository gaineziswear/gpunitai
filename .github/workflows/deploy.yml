name: Deploy
on: [push]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Build Containers
        run: |
          docker build -f docker/Dockerfile.api -t your-registry/api:$GITHUB_SHA .
          docker push your-registry/api:$GITHUB_SHA
      - name: Deploy to Kubernetes
        uses: steebchen/kubectl@v2
        env:
          KUBECONFIG: ${{ secrets.KUBECONFIG }}
        with:
          command: set image deployment/quantum-gpu api=your-registry/api:$GITHUB_SHA
